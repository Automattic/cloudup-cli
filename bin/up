#!/usr/bin/env node

/**
 * Module dependencies.
 */

var program = require('commander')
  , Cloudup = require('cloudup-client')
  , path = require('path')
  , sprintf = require('printf')
  , basename = path.basename
  , ms = require('ms')
  , up = require('..');

// options

program
  .usage('[options] [file ...]')
  .option('-t, --title <name>', 'collection title name', 'Undefined')
  .parse(process.argv);

// client

var client = new Cloudup({
  url: 'http://localhost:3000',
  user: 'Ewald',
  pass: 'Dev1'
});

// collection

var title = program.title;
var files = program.args;
var col = client.collection({ title: title });
var start = new Date;

// view

console.log();
log('title', title);
log('items', files.length);
files.forEach(function(file){
  var item = col.item({ title: basename(file) }); // TODO: remove title
  if (isUrl(file)) return item.url(file);
  item.file(file);
});

// save

col.save(function(err){
  if (err) throw err;
  col.items.forEach(function(item){
    var ctx = item._file || item._url;
    log('item', ctx + ': https://cloudup.com/' + col.uid + '/' + item.uid);
  });
  log('collection', 'https://cloudup.com/' + col.uid);
  log('complete', ms(new Date - start));
  console.log();
});

function log(key, str) {
  process.stdout.write(sprintf('\033[36m%15s\033[0m : %s\n', key, str));
}

function isUrl(str) {
  return ~str.indexOf('://');
}
