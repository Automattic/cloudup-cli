#!/usr/bin/env node

/**
 * Module dependencies.
 */

var program = require('commander')
  , Cloudup = require('cloudup-client')
  , path = require('path')
  , basename = path.basename
  , up = require('..');

// options

program
  .usage('[options] [file ...]')
  .option('-t, --title <name>', 'collection title name', 'Undefined')
  .parse(process.argv);

// client

var client = new Cloudup({
  url: 'http://localhost:3000',
  user: 'Ewald',
  pass: 'Dev1'
});

// collection

var title = program.title;
var files = program.args;
var col = client.collection({ title: title });

col.save(function(err){
  if (err) throw err;
  var view = up.view();

  files.forEach(function(file){
    var item = col.item({ title: basename(file) }); // TODO: remove title
    item.file(file);
    view.add(item);
    item.save(function(err){
      if (err) throw err;
    });
  });

  view.draw();
});
