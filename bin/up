#!/usr/bin/env node

/**
 * Module dependencies.
 */

var program = require('commander')
  , path = require('path')
  , basename = path.basename
  , up = require('..');

// options

program
  .usage('[options] [file ...]')
  .option('-t, --title <name>', 'collection title name', 'Undefined')
  .option('-d, --direct', 'output direct links')
  .option('-j, --json', 'output json')
  .option('-J, --json-stream', 'output streaming json')
  .parse(process.argv);

// reporter

var reporter = 'console';
if (program.json) reporter = 'json';
if (program.jsonStream) reporter = 'json-stream';

// collection

var files = program.args;
var title = program.title;
var col = up.collection({
  title: title,
  reporter: reporter,
  direct: program.direct
});

// files

files.forEach(function(file){
  var item = col.item({ title: basename(file) }); // TODO: remove title
  if (isUrl(file)) return item.url(file);
  item.file(file);
});

// save

col.save(function(err){
  if (err) throw err;
});

/**
 * Check if `str` is a url.
 */

function isUrl(str) {
  return ~str.indexOf('://');
}
